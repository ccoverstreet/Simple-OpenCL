The reduction kernel seems to have a race condition. Is atomic_add or work_group_reduce_add to blame?
